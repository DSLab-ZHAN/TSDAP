# Spider Design Brain Fuck

1. 对于TSDAP平台而言，每一个爬虫都应是一个完全独立的，且主函数继承了ISpider接口的个体，以Zip包的形式，导入到TSDAP平台中，在平台中，该包将被称之为爬虫包(Spider Package)

2. 在包中，包含`compose.json`文件，来描述该爬虫的基本信息，名称，版本，入口文件名等必要信息，具体信息参见下文`特定章节`**注意: 整个包有且仅有一个入口类，且必须继承ISpider抽象接口，否则抛出异常**

3. 和Docker中Image文件相同，每一个爬虫包都将先通过spider load命令加载到内部，而后通过spider run来初始化环境并启动特定的爬虫，而在后续启动中都将使用start启动，其他操作与Docker命令基本一致


# spider load
1. 该命令接收一个参数，Zip包所在路径，而后，将读取包内`compose.json`，并将zip包解压至爬虫库目录中(该目录在平台`setting.json`文件中设置)，同时，文件夹名称将被重命名为镜像ID (取值方法使用包文件指纹，例如sha256)，并一并将所有信息 (名称，版本等)，写入平台数据库中备用

# spider run
1. 该命令将接收一个必要参数，`爬虫名称:版本` (参考Docker Image命名方式)，随后初始化一个，被称作`容器`的工作目录(根目录将在平台`setting.json`中设置)中加载，运行，工作目录名称将采用`随机数+SHA256`生成一个唯一`容器ID`，具体可选参数见下表

| 参数 | 说明 | 默认值 |
| --- | --- | --- |
| -d, --daemon | 是否以驻留进程方式运行 | False |
| --name | 容器名称 | 随机组合词汇 |
| -e, --env | 环境变量 | 无 |

2. 对于爬虫代码而言，容器根目录是不可访问的，容器目录结构如下

```
- {ID}
  - /db
  - /{name}

```

3. 在容器中，将新建`db`文件夹，用于存放爬虫工作时数据，例如，爬虫中所需要持久化数据，运行日志等必要数据

4. 爬虫爬取的所有数据，都将存放于MySQL数据库中

5. 启动容器后，启动参数等必要参数，都将持久化保存到爬虫平台数据库中
